<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>

<div id="app">
	<h1>Sistema Financeiro (SISFIN)</h1>
	<h2>Módulo de Integração ao SISRH</h2>
	Usuário: <input v-model="usuario" placeholder="Usuário">
	Senha: <input v-model="senha" placeholder="Senha">
	<button v-on:click="login">Login</button>
	<hr />
	Token JWT:
	<div style="color: blue; width: 400px; word-wrap: break-word">{{ tokenJWT }}</div>
	<hr />	

	<h3>Folha de Pagamento</h3>
	<!-- Botões -->
	<button v-on:click="listarEmpregados()">Calcular Folha (Todos)</button>
	<button v-on:click="listarEmpregados(true)">Listar Ativos</button>
	<button v-on:click="listarEmpregados(false)">Listar Inativos</button>

	<div style="color: red">{{errorMessage}}</div>

	<div v-if="totalFolha > 0">
		<hr />
		<div style="color: blue">Total de Empregados: {{ totalEmpregados }}</div>
		<div style="color: blue">Folha de Pagamento: R$ {{ totalFolha }},00</div>
		<hr />
		<h3 v-if="totalFolha > 0">Lista de Empregados</h3>
		<ul>
			<li v-for="empregado in listaEmpregado" :key="empregado.matricula">
				{{ empregado.nome }} : R$ {{ empregado.salario }},00 
				<span style="color: green" v-if="empregado.desligamento === null">[Ativo]</span>
				<span style="color: red" v-else>[Inativo]</span>
			</li>
		</ul>
		<hr />
	</div>
</div>

<script>
var app = new Vue({
	el: '#app',
	data: {
		url: 'http://localhost:8080/sisrh/rest',
		usuario : 'sisfin',
		senha : '123456',
		tokenJWT: 'vazio',
		errorMessage : "",
		listaEmpregado: []
	},
	methods: {
		login: function () {
			this.tokenJWT = 'vazio';
			this.errorMessage = "";
			this.listaEmpregado = [];
			const login = { 'usuario' : this.usuario, 'senha' : this.senha };
			axios.post(this.url + '/loginunico/jwt', login)
			.then(response => this.tokenJWT = response.data)
			.catch(error => {
				this.errorMessage = error;
				console.error("There was an error!", error);
			});
		},
		listarEmpregados: function (ativo = null) {
			let urlFinal = this.url + '/empregado';
			if (ativo !== null) {
				urlFinal += '?ativo=' + ativo; 
			}
			axios.get(urlFinal, { headers: { 'jwt': this.tokenJWT } })
			.then(response => {
				this.listaEmpregado = response.data;
			})
			.catch(error => {
				this.errorMessage = error.message;
				console.error("There was an error!", error);
			});
		}
	},
	computed: {
		totalFolha: function () {
			return this.listaEmpregado.reduce(
				(acumulador, emp) => acumulador + emp.salario, 0
			);
		},
		totalEmpregados: function () {
			return this.listaEmpregado.length;
		}
	}
})
</script>

<style>
body {
	font: normal 12px Verdana, Arial, sans-serif;
}
</style>
